import React, { useMemo, useState } from 'react';

function currency(n){ return '‚Çπ' + n.toFixed(2); }

const initialProducts = [
  { id: 1, name: 'Leggings', price: 299, image: '/images/leggings.jpg' },
  { id: 2, name: 'Kurti Pants', price: 399, image: '/images/kurti-pants.jpg' },
  { id: 3, name: 'Palazzos', price: 449, image: '/images/palazzos.jpg' },
  { id: 4, name: 'Cigar Pants', price: 499, image: '/images/cigar-pants.jpg' },
  { id: 5, name: 'Straight Pants', price: 549, image: '/images/straight-pants.jpg' },
];

export default function App(){
  const [cart, setCart] = useState([]);
  const [showCart, setShowCart] = useState(false);

  function addToCart(p){
    setCart(prev => {
      const existing = prev.find(x => x.id === p.id);
      if(existing){
        return prev.map(x => x.id === p.id ? { ...x, qty: x.qty + 1 } : x);
      }
      return [...prev, { ...p, qty: 1 }];
    });
  }

  function removeOne(id){
    setCart(prev => {
      const found = prev.find(x => x.id === id);
      if(!found) return prev;
      if(found.qty <= 1) return prev.filter(x => x.id !== id);
      return prev.map(x => x.id === id ? { ...x, qty: x.qty - 1 } : x);
    });
  }

  function removeLine(id){
    setCart(prev => prev.filter(x => x.id !== id));
  }

  const total = useMemo(() => cart.reduce((s, x) => s + x.price * x.qty, 0), [cart]);

  function handlePayment(){
    if(cart.length === 0){
      alert('Your cart is empty.');
      return;
    }
    if(!(window && window.Razorpay)){
      alert('Razorpay SDK not loaded yet. Please wait a moment and try again.');
      return;
    }
    const options = {
      key: 'rzp_test_1234567890abcdef', // TODO: replace with your real Test Key ID
      amount: Math.round(total * 100), // paise
      currency: 'INR',
      name: 'Seemati Ladies Wear',
      description: 'Order Payment (Test Mode)',
      handler: function (response) {
        alert('Payment Successful!\nPayment ID: ' + response.razorpay_payment_id);
        // Clear cart after success (demo)
        setCart([]);
        setShowCart(false);
      },
      prefill: { name: 'Test User', email: 'test@example.com', contact: '9999999999' },
      notes: { brand: 'Seemati Ladies Wear', mode: 'test' },
      theme: { color: '#e91e63' }
    };
    const rzp = new window.Razorpay(options);
    rzp.open();
  }

  return (
    <div>
      <header>
        <div className="container nav">
          <div className="logo">Seemati Ladies Wear</div>
          <nav className="menu">
            <a href="#home">Home</a>
            <a href="#about">About</a>
            <a href="#products">Products</a>
            <a href="#catalog">Catalog</a>
            <a href="#stockist">Super Stockist</a>
            <a href="#contact">Contact</a>
          </nav>
          <button className="cart-btn" onClick={() => setShowCart(true)}>
            üõí Cart
            {cart.length > 0 && <span className="badge">{cart.reduce((s,x)=>s+x.qty,0)}</span>}
          </button>
        </div>
      </header>

      <section id="home" className="hero">
        <h1>Elevate Your Style</h1>
        <p>Premium leggings, kurti pants, palazzos, cigar pants and straight pants ‚Äî crafted for elegance & comfort.</p>
        <a className="btn" href="#products">Shop Now</a>
      </section>

      <section id="about" className="section gray">
        <div className="container">
          <h2>About Us</h2>
          <p style={{textAlign:'center', maxWidth:820, margin:'0 auto'}}>
            At <b>Seemati Ladies Wear</b>, we design everyday essentials that blend comfort, durability and great fit.
            Our styles are made with quality fabrics and modern tailoring. We serve retail customers, wholesalers and
            stockists/distributors across India.
          </p>
        </div>
      </section>

      <section id="products" className="section">
        <div className="container">
          <h2>Our Products</h2>
          <div className="grid">
            {initialProducts.map(p => (
              <div className="card" key={p.id}>
                <img src={p.image} alt={p.name} />
                <div className="body">
                  <h4>{p.name}</h4>
                  <p>{currency(p.price)}</p>
                  <button className="btn" onClick={() => addToCart(p)}>Add to Cart</button>
                </div>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section id="catalog" className="section gray">
        <div className="container" style={{textAlign:'center'}}>
          <h2>Price List / Catalog</h2>
          <p>Download our latest catalog with wholesale & retail prices.</p>
          <button className="btn secondary" onClick={()=>alert('In demo mode. You can link a real PDF later.')}>Download Catalog</button>
        </div>
      </section>

      <section id="stockist" className="section">
        <div className="container" style={{maxWidth:680}}>
          <h2 style={{textAlign:'center'}}>Super Stockist Enquiry</h2>
          <div style={{display:'grid', gap:12}}>
            <input className="input" placeholder="Full Name" />
            <input className="input" placeholder="Email Address" />
            <input className="input" placeholder="Phone Number" />
            <textarea className="input" placeholder="Business Details" rows={5} />
            <button className="btn" onClick={()=>alert('Thank you! We will contact you shortly (demo).')}>Submit Enquiry</button>
          </div>
        </div>
      </section>

      <section id="contact" className="section gray">
        <div className="container" style={{textAlign:'center'}}>
          <h2>Contact Us</h2>
          <p>üìç Vellore, Tamil Nadu</p>
          <p>üìû +91-XXXXXXXXXX</p>
          <p>‚úâÔ∏è info@seemati.com</p>
          <small className="muted">Seemati Ladies Wear ‚Äî Elevate Your Style</small>
        </div>
      </section>

      <footer>
        ¬© {new Date().getFullYear()} Seemati Ladies Wear. All rights reserved.
      </footer>

      {showCart && (
        <div className="modal-backdrop" onClick={(e)=>{ if(e.target.classList.contains('modal-backdrop')) setShowCart(false)}}>
          <div className="modal">
            <h3 style={{marginTop:0}}>Your Cart</h3>
            {cart.length === 0 ? (
              <p>Your cart is empty.</p>
            ) : (
              <div>
                {cart.map(item => (
                  <div className="row" key={item.id}>
                    <div style={{flex:1}}>
                      {item.name} √ó {item.qty}
                    </div>
                    <div>{currency(item.price * item.qty)}</div>
                    <div>
                      <button className="btn secondary" onClick={()=>removeOne(item.id)}>-</button>{' '}
                      <button className="btn secondary" onClick={()=>addToCart(item)}>+</button>{' '}
                      <button className="btn" onClick={()=>removeLine(item.id)}>Remove</button>
                    </div>
                  </div>
                ))}
                <div className="total">Total: {currency(total)}</div>
                <div style={{marginTop:12, display:'grid', gap:8}}>
                  <button className="btn" onClick={handlePayment}>Proceed to Checkout (Test)</button>
                  <button className="btn secondary" onClick={()=>setShowCart(false)}>Close</button>
                </div>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
}
